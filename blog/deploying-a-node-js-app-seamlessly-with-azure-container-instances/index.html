<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=Content-Language content="en"><meta name=author content="Bhabuk Kunwar"><meta name=description content="I add aria2 as a download manager to a NixOS server to help bundle my Bandcamp downloads together"><meta name=keywords content="blog,developer,devops,cloud"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deploying a Node.js App Seamlessly with Azure Container Instances"><meta name=twitter:description content="I add aria2 as a download manager to a NixOS server to help bundle my Bandcamp downloads together"><meta property="og:title" content="Deploying a Node.js App Seamlessly with Azure Container Instances"><meta property="og:description" content="I add aria2 as a download manager to a NixOS server to help bundle my Bandcamp downloads together"><meta property="og:type" content="article"><meta property="og:url" content="https://orange-moss-0ac12ca0f.2.azurestaticapps.net/blog/deploying-a-node-js-app-seamlessly-with-azure-container-instances/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-09-06T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-06T00:00:00+00:00"><title>Deploying a Node.js App Seamlessly with Azure Container Instances · Bhabuk Kunwar
</title><link rel=canonical href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/blog/deploying-a-node-js-app-seamlessly-with-azure-container-instances/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fork-awesome/1.1.7/css/fork-awesome.min.css integrity="sha512-9QjPqX/aCNwEQDyMqqMluNOSsHxTwOJNO3d4m5aUeNbyOPm8RcBA5hCUhvGmKFtSmQYGajqPopGtD60FWiWUwg==" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w==" crossorigin=anonymous><link rel=stylesheet href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/css/coder.min.f01c647a0d25b40da992a37c3376291185eed8a50ced8c26cc2c0bcfe38c97df.css integrity="sha256-8Bxkeg0ltA2pkqN8M3YpEYXu2KUM7YwmzCwLz+OMl98=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/css/coder-dark.min.126ad3988d46bdae6217a11105b53c9662bca05f39d42d3c0fb366919d334620.css integrity="sha256-EmrTmI1Gva5iF6ERBbU8lmK8oF851C08D7NmkZ0zRiA=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/images/apple-touch-icon.png><meta name=generator content="Hugo 0.124.1"></head><body class=colorscheme-dark><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/>Bhabuk Kunwar
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/blog/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/contact/>Contact</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Deploying a Node.js App Seamlessly with Azure Container Instances</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2024-09-06T00:00:00Z>6 September 2024
</time></span><span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
6-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<a href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/tags/azure/>Azure</a>
<span class=separator>•</span>
<a href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/tags/azure-container-instances/>Azure Container Instances</a>
<span class=separator>•</span>
<a href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/tags/docker/>docker</a>
<span class=separator>•</span>
<a href=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/tags/node/>node</a></div></div></header><div><p>Azure Container Instances is a Platform as a Service (PaaS) offering from Azure that allows you to run and deploy containers without the need of managing the underlying infrastructure.</p><p>Azure Container Registry, on the other hand, provides a secure, private registry for managing container images within the Azure ecosystem.</p><p>In this post, we will first learn how to containerize a Node.js application using Docker, and then deploy it to the cloud using Azure services such as Azure Container Instances (ACI) and Azure Container Registry (ACR).</p><p>Before we begin, make sure you have the following prerequisites installed on your machine:</p><ul><li><p><a href=https://learn.microsoft.com/en-us/cli/azure/>Azure CLI</a></p><ul><li><p><a href=https://www.docker.com/products/docker-desktop/>Docker</a></p><ul><li>Git</li></ul></li></ul></li></ul><h3 id=step-1--containerizing-a-nodejs-app-using-docker>Step 1 : Containerizing a Node.js app using Docker</h3><p>Let&rsquo;s start by cloning the following GitHub repository into your local machine.</p><p><a href=https://github.com/bhabukkunwar/AzureWeatherApp>https://github.com/bhabukkunwar/AzureWeatherApp</a></p><p>It&rsquo;s a simple weather app written in Node.js. You&rsquo;ll find a <em>Dockerfile</em> in the root directory which will be used for building our Docker image. Here&rsquo;s the snippet of the docker file.</p><p>![](<a href=https://cdn.hashnode.com/res/hashnode/image/upload/v1725124369989/02150624-b219-43ed-8aff-abd6cfe6f6c1.png>https://cdn.hashnode.com/res/hashnode/image/upload/v1725124369989/02150624-b219-43ed-8aff-abd6cfe6f6c1.png</a> align=&ldquo;center&rdquo;)</p><p>In your root directory create an .env file. Here <code>app_id</code> is an API key provided by <a href=https://openweathermap.org/api>Open Weather Map API</a>. Go ahead an create an account to generate a free API key and use it in the .env file as below.</p><p>![](<a href=https://cdn.hashnode.com/res/hashnode/image/upload/v1725632166076/73605559-b3bc-47f6-a55b-81b8a96c68e4.png>https://cdn.hashnode.com/res/hashnode/image/upload/v1725632166076/73605559-b3bc-47f6-a55b-81b8a96c68e4.png</a> align=&ldquo;center&rdquo;)</p><p>Now to Dockerize the application execute the following steps inside project&rsquo;s root directory.</p><p>i. Build the Docker image using the following command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build -t azure-weather-app:latest .
</span></span></code></pre></div><p>![](<a href=https://cdn.hashnode.com/res/hashnode/image/upload/v1725124620143/a95df3a4-ee43-4849-bb0d-05065e92eb4d.png>https://cdn.hashnode.com/res/hashnode/image/upload/v1725124620143/a95df3a4-ee43-4849-bb0d-05065e92eb4d.png</a> align=&ldquo;center&rdquo;)</p><p>The <code>-t</code> flag allows us to tag our Docker images. The tag should come after the colon <code>:</code> in the format <code>image-name:tag</code>. Tagging is essential when pushing images to registries as it helps manage multiple versions of the same image. By default Docker tags all images as <code>latest</code> unless specified otherwise.</p><p>ii. Check whether the image was built correctly with the latest tag using <em>Docker images</em> command.</p><p>![](<a href=https://cdn.hashnode.com/res/hashnode/image/upload/v1725124852606/299cbc12-8f66-4b4a-b278-de2169c16e93.png>https://cdn.hashnode.com/res/hashnode/image/upload/v1725124852606/299cbc12-8f66-4b4a-b278-de2169c16e93.png</a> align=&ldquo;center&rdquo;)</p><p>iii. You can also test by running the container image locally with the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -p 80:80 azure-weather-app
</span></span></code></pre></div><p>The above command will deploy the app locally which can be accessed through <em>http://localhost</em> url in your browser.</p><h3 id=step-2-creating-azure-container-registry-and-pushing-our-docker-image>Step 2: Creating Azure Container Registry and pushing our Docker image</h3><p>i. Inside your preferred terminal first login to your azure account using az cli.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az login
</span></span></code></pre></div><p>ii. Next, create a resource group. We will use this resource group to deploy our ACR and ACI.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az group create --name rg-az-weather-app --location eastus
</span></span></code></pre></div><p>iii. Create Azure Container Registry in the above resource group.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az acr create --resource-group rg-az-weather-app  --name azureweatherappregistry --sku Basic
</span></span></code></pre></div><p>iv. Now login should be possible to the newly created ACR using the following command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az acr login --name azureweatherappregistry
</span></span></code></pre></div><p>v. In this section, we will create a service principal in Azure with the sole purpose of authenticating Azure Container Registry (ACR) with Docker and pushing our Docker image. It is strongly recommended to use a service principal for authenticating with ACR instead of using personal Azure account credentials.</p><p><strong>What is a Service Principal and why should you use it?</strong></p><p>A Service Principal (SP) in Azure acts as an identity used by applications or automated processes to access specific Azure resources. Instead of using your personal credentials (which could expose unnecessary access), the SP provides a way to control permissions more securely and granularly. In this guide, we’re using the SP to authenticate our Docker commands with Azure Container Registry (ACR), allowing us to push our container image securely.</p><p>Now that we&rsquo;ve learned the importance of a Service Principal. Let&rsquo;s go ahead and create one.</p><ul><li><p>In your Azure Portal, go into App registrations and click on &lsquo;New registration&rsquo;.</p><pre><code>  ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725195095762/49e19d57-a53e-48b4-911d-b84435631011.png align=&quot;center&quot;)

      * Provide a user-facing name for our Service Principal(SP).

              ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725195155408/4c7dd6f8-2435-426b-bfb7-e9da5ae77513.png align=&quot;center&quot;)

                  * Next, we need a client secret. Click on 'Certificates &amp; secrets' and 'New client secret'.

                          ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725195505558/9e2ff4e3-012b-4288-9db1-095e0edbef22.png align=&quot;center&quot;)

                              * Set description and expiry date and click on 'Add'.

                                  * A client secret will be created. Make sure to copy the value, as it is only available once. We will use this secret later.

                                          ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725195725025/b45094f6-ef06-4968-88a2-2c824d12d393.png align=&quot;center&quot;)

                                              * Now, in the Access Control (IAM) for ACR, assign the 'AcrPush' role to our service principal following the steps below.

                                                      * Inside 'azureweatherappregistry', click on Access control (IAM) and then 'Add role assignment'.

                                                                      ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725197432897/771cabb1-d8c5-418a-b024-e764a5cbe16b.png align=&quot;center&quot;)

                                                                                  * Search for 'AcrPush' and select it.

                                                                                                  ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725197404441/f9543df4-5bac-44df-b71e-e4faa0317b41.png align=&quot;center&quot;)

                                                                                                              * In Members tab, make sure 'User, group or service principal' option is selected and click on 'Select members', search and select the SP 'AzureWeatherApp-SP-EUS' we created in the above steps.

                                                                                                                              ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725197367593/5bfd47e6-5df2-4318-a368-8f79c4ee4b3a.png align=&quot;center&quot;)

                                                                                                                                          * Click on 'Review + assign'.

                                                                                                                                                          ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725197566466/7105e168-7f9e-47be-9c20-d16083e1408f.png align=&quot;left&quot;)


                                                                                                                                                                  *Phew, that was a lot! But don't worry we are almost done*

                                                                                                                                                                  vi. Remember the client secret we created for our SP in step v? Let's make use of that now to log in to our ACR with Docker. You'll also need client ID which can be copied from the overview page of the 'AzureWeatherApp-SP-EUS' app registration.

                                                                                                                                                                  ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725198750382/bb495b46-12c7-44dc-8059-8a7bdf9f985e.png align=&quot;center&quot;)

                                                                                                                                                                  vii. Execute the following command to login to ACR using Docker.

                                                                                                                                                                  *Note: Replace* ***&amp;lt;sp-secret-value&amp;gt;*** *and* ***&amp;lt;sp-client-id&amp;gt;*** *with the actual values of our service principal client id and client secret values.*

                                                                                                                                                                  ```bash
                                                                                                                                                                  docker login azureweatherappregistry.azurecr.io --username &lt;sp-client-id&gt; --password &lt;sp-secret-value&gt;
                                                                                                                                                                  ```

                                                                                                                                                                  ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725199692069/dc9d3060-8403-4406-b46b-a7052ca6c97a.png align=&quot;center&quot;)

                                                                                                                                                                  viii. Tag the Docker image created in Step 1 with the fully qualified path to your ACR.

                                                                                                                                                                  ```bash
                                                                                                                                                                  docker tag azure-weather-app azureweatherappregistry.azurecr.io/azure-weather-app:latest
                                                                                                                                                                  ```

                                                                                                                                                                  Here, azureweatherappregistry.azurecr.io is the FQDN provided by Azure which follows the following convention &amp;lt;your-acr-name&amp;gt;.azurecr.io  
                                                                                                                                                                  We follow it by a slash and appending our previously created docker image name with the assigned tag &amp;lt;your-acr-name&amp;gt;.azurecr.io/&amp;lt;your-docker-image-name&amp;gt;:&amp;lt;tag&amp;gt;

                                                                                                                                                                  We can also get our ACR login server domain using the command below:

                                                                                                                                                                  ```bash
                                                                                                                                                                  az acr show --name azureweatherappregistry --query loginServer
                                                                                                                                                                  ```

                                                                                                                                                                  ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725180059988/b768dc44-20d4-42c7-a1e9-874ac578059d.png align=&quot;center&quot;)

                                                                                                                                                                  ix. Next, use the Docker command below to push the Docker image we created during Step 1.

                                                                                                                                                                  ```bash
                                                                                                                                                                  docker push azureweatherappregistry.azurecr.io/azure-weather-app:latest
                                                                                                                                                                  ```

                                                                                                                                                                  ![](https://cdn.hashnode.com/res/hashnode/image/upload/v1725200399906/9184cd9e-bc9f-4ab2-a1ba-67caf54691cd.png align=&quot;center&quot;)
</code></pre></li></ul><h3 id=step-3-deploying-application-to-azure-container-instances>Step 3: Deploying application to Azure Container Instances</h3><p>i. Run a command like the one below to start a container instance. Choose a <code>--dns-name-label</code> value that is unique within the Azure region where you&rsquo;re creating the instance. If you encounter a &ldquo;DNS name label not available&rdquo; error, try using a different DNS name label.</p><p>We opted for a public IP here to allow external access to the application, but you could also configure a private IP for internal usage scenarios.<br>The image is set to the one we previously pushed to our ACR, and the port is configured to 80, where the Node.js application is running.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az container create --resource-group rg-az-weather-app --name aci-weather-app --image azureweatherappregistry.azurecr.io/azure-weather-app:latest --cpu <span style=color:#bd93f9>1</span> --memory <span style=color:#bd93f9>1</span> --registry-login-server azureweatherappregistry.azurecr.io --registry-username &lt;sp-client-id&gt; --registry-password &lt;sp-secret-value&gt; --ip-address Public --dns-name-label azurewebappcontainer --ports <span style=color:#bd93f9>80</span>
</span></span></code></pre></div><p><em>Note: Replace</em> <em><strong>&lt;sp-secret-value></strong></em> <em>and</em> <em><strong>&lt;sp-client-id></strong></em> <em>with the actual values of our service principal client id and client secret values.</em></p><p>![](<a href=https://cdn.hashnode.com/res/hashnode/image/upload/v1725206899955/4ced1302-4e33-444b-a664-ec63bd3bfb83.png>https://cdn.hashnode.com/res/hashnode/image/upload/v1725206899955/4ced1302-4e33-444b-a664-ec63bd3bfb83.png</a> align=&ldquo;center&rdquo;)</p><p>ii. To get the FQDN or the URL of our deployed container instance. Execute the following command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az container show --resource-group rg-az-weather-app --name aci-weather-app --query ipAddress.fqdn
</span></span></code></pre></div><p>![](<a href=https://cdn.hashnode.com/res/hashnode/image/upload/v1725207340238/b0009231-5954-4b0a-99aa-224a18653794.png>https://cdn.hashnode.com/res/hashnode/image/upload/v1725207340238/b0009231-5954-4b0a-99aa-224a18653794.png</a> align=&ldquo;center&rdquo;)</p><p>iii. Follow the URL in your browser, you&rsquo;ll see a screen like below.</p><p>![](<a href=https://cdn.hashnode.com/res/hashnode/image/upload/v1725207405537/6c8e710c-c5ff-4da3-a8c9-71642937deab.png>https://cdn.hashnode.com/res/hashnode/image/upload/v1725207405537/6c8e710c-c5ff-4da3-a8c9-71642937deab.png</a> align=&ldquo;center&rdquo;)</p><p>iv. Since this is a weather app, enter the name of the city for which you&rsquo;d like to view the weather forecast. For example, I&rsquo;m using Kathmandu, the capital city of Nepal.</p><p>![](<a href=https://cdn.hashnode.com/res/hashnode/image/upload/v1725207555388/85364bc5-5061-4f8f-84e4-e9785b8e4fe5.png>https://cdn.hashnode.com/res/hashnode/image/upload/v1725207555388/85364bc5-5061-4f8f-84e4-e9785b8e4fe5.png</a> align=&ldquo;center&rdquo;)</p><p>![](<a href=https://cdn.hashnode.com/res/hashnode/image/upload/v1725207568973/95408cac-5157-4b7e-ad9d-1438f69ea2e4.png>https://cdn.hashnode.com/res/hashnode/image/upload/v1725207568973/95408cac-5157-4b7e-ad9d-1438f69ea2e4.png</a> align=&ldquo;center&rdquo;)</p><p>v. <em>Voilà!</em> we have successfully deployed the application and it&rsquo;s running on the cloud believe it or not.</p><p>In this tutorial, we learned how to containerize and deploy a Node.js application to Azure using Azure Container Instances and Azure Container Registry. By leveraging the power of Azure services, we simplified the entire deployment process, focusing on code and functionality rather than managing infrastructure. You can replicate this process with any Dockerized application to quickly deploy and test in the cloud.</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2025
Bhabuk Kunwar
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=https://orange-moss-0ac12ca0f.2.azurestaticapps.net/js/dark-mode.min.c2d8a1f8f2660e4a46d776277c72695a1e0ca65939d79f754441d47551604af5.js></script></body></html>